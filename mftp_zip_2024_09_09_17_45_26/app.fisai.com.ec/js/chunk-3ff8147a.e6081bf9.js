(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3ff8147a"],{"0ccb":function(t,e,a){"use strict";var r=a("e330"),i=a("50c4"),n=a("577e"),o=a("1148"),s=a("1d80"),c=r(o),l=r("".slice),d=Math.ceil,u=function(t){return function(e,a,r){var o,u,f=n(s(e)),m=i(a),p=f.length,v=void 0===r?" ":n(r);return m<=p||""===v?f:(o=m-p,u=c(v,d(o/v.length)),u.length>o&&(u=l(u,0,o)),t?f+u:u+f)}};t.exports={start:u(!1),end:u(!0)}},1148:function(t,e,a){"use strict";var r=a("5926"),i=a("577e"),n=a("1d80"),o=RangeError;t.exports=function(t){var e=i(n(this)),a="",s=r(t);if(s<0||s===1/0)throw o("Wrong number of repetitions");for(;s>0;(s>>>=1)&&(e+=e))1&s&&(a+=e);return a}},"2ca0":function(t,e,a){"use strict";var r=a("23e7"),i=a("4625"),n=a("06cf").f,o=a("50c4"),s=a("577e"),c=a("5a34"),l=a("1d80"),d=a("ab13"),u=a("c430"),f=i("".startsWith),m=i("".slice),p=Math.min,v=d("startsWith"),b=!u&&!v&&!!function(){var t=n(String.prototype,"startsWith");return t&&!t.writable}();r({target:"String",proto:!0,forced:!b&&!v},{startsWith:function(t){var e=s(l(this));c(t);var a=o(p(arguments.length>1?arguments[1]:void 0,e.length)),r=s(t);return f?f(e,r,a):m(e,a,a+r.length)===r}})},"358c":function(t,e,a){"use strict";e["a"]={webBaseURL:Object({NODE_ENV:"production",VUE_APP_URL:"/",VUE_APP_API_URL:"https://api.fisai.com.ec/api",BASE_URL:"/"}).MIX_APP_URL,defaultImage:"https://cdn-icons-png.flaticon.com/512/1085/1085413.png",defaultUserImage:"https://cdn-icons-png.flaticon.com/512/1430/1430453.png"}},3835:function(t,e,a){"use strict";function r(t){if(Array.isArray(t))return t}a.d(e,"a",(function(){return s}));a("a4d3"),a("e01a"),a("d3b7"),a("d28b"),a("3ca3"),a("ddb0"),a("14d9");function i(t,e){var a=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=a){var r,i,n,o,s=[],c=!0,l=!1;try{if(n=(a=a.call(t)).next,0===e){if(Object(a)!==a)return;c=!1}else for(;!(c=(r=n.call(a)).done)&&(s.push(r.value),s.length!==e);c=!0);}catch(t){l=!0,i=t}finally{try{if(!c&&null!=a["return"]&&(o=a["return"](),Object(o)!==o))return}finally{if(l)throw i}}return s}}var n=a("06c5");a("d9e2");function o(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function s(t,e){return r(t)||i(t,e)||Object(n["a"])(t,e)||o()}},"4d90":function(t,e,a){"use strict";var r=a("23e7"),i=a("0ccb").start,n=a("9a0c");r({target:"String",proto:!0,forced:n},{padStart:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}})},"9a0c":function(t,e,a){"use strict";var r=a("342f");t.exports=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(r)},c4df:function(t,e,a){"use strict";a.r(e);a("4de4"),a("d3b7"),a("d81d");var r=function(){var t=this,e=t._self._c;return e("b-container",{attrs:{fluid:""}},[e("b-row",[e("b-col",{attrs:{md:"12"}},[e("iq-card",{scopedSlots:t._u([{key:"headerTitle",fn:function(){return[e("h4",{staticClass:"card-title"},[t._v("Lista de Citas")])]},proxy:!0},{key:"headerAction",fn:function(){return[e("select",{directives:[{name:"model",rawName:"v-model",value:t.filter,expression:"filter"}],staticClass:"form-control",on:{change:[function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.filter=e.target.multiple?a:a[0]},t.getData]}},[e("option",{attrs:{value:"actual"}},[t._v("Actual")]),e("option",{attrs:{value:"past"}},[t._v("Antiguas")]),e("option",{attrs:{value:"all"}},[t._v("Todo")])]),e("b-button",{directives:[{name:"user-can",rawName:"v-user-can",value:"crear citas",expression:"'crear citas'"}],attrs:{variant:"primary"},on:{click:function(e){return t.showModal("add",{patient_id:t.patientId,doctor_id:null,service_id:null,date:"",status:"AGENDADA",notes:"-"})}}},[t._v(" Agregar ")])]},proxy:!0},{key:"body",fn:function(){return[t.appointments?e("DataTable",{attrs:{data:t.appointments,columns:t.columns,"fields-search":["service","patient","doctor","status"]},scopedSlots:t._u([{key:"rows",fn:function(a){var r=a.row,i=a.rowIndex;return[e("tr",[e("th",{attrs:{scope:"row"}},[t._v(t._s(i+1))]),e("td",[t._v("#"+t._s(r.code))]),e("td",[t._v(" "+t._s(r.date_format)+" | "+t._s(r.start_time)+"-"+t._s(r.final_time)+" ")]),e("td",[t._v(" "+t._s(r.service)+" ")]),e("td",[t._v(" "+t._s(r.patient)+" ")]),e("td",[t._v(" "+t._s(r.doctor)+" ")]),e("td",["AGENDADA"===r.status?e("b-badge",{attrs:{variant:"primary"}},[t._v(" "+t._s(r.status)+" ")]):"REAGENDADA"===r.status?e("b-badge",{attrs:{variant:"secondary"}},[t._v(" "+t._s(r.status)+" ")]):"CANCELADO"===r.status?e("b-badge",{attrs:{variant:"danger"}},[t._v(" "+t._s(r.status)+" ")]):e("b-badge",{attrs:{variant:"success"}},[t._v(t._s(r.status))])],1),e("td",[e("b-button-group",["Paciente"!=t.role?e("b-button",{directives:[{name:"user-can",rawName:"v-user-can",value:"leer pacientes",expression:"'leer pacientes'"},{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],attrs:{variant:"success",size:"sm",title:"Detalle Paciente"},on:{click:function(e){return t.goToEdit(r.patient_id)}}},[e("i",{staticClass:"ri-file-list-line m-0"})]):t._e(),"Paciente"!=t.role?e("b-button",{directives:[{name:"user-can",rawName:"v-user-can",value:"crear citas",expression:"'crear citas'"},{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],attrs:{variant:"secondary",size:"sm",title:"Agregar Tratamiento"},on:{click:function(e){return t.createTreatment(r)}}},[e("i",{staticClass:"ri-add-box-line m-0"})]):t._e(),"Paciente"!==t.role?e("b-button",{directives:[{name:"user-can",rawName:"v-user-can",value:"actualizar citas",expression:"'actualizar citas'"},{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],attrs:{variant:"info",size:"sm",title:"Cambiar Estado"},on:{click:function(e){return t.changeStatusModal("modal-status",r)}}},[e("i",{staticClass:"ri-arrow-left-fill m-0"})]):t._e(),"CANCELADO"!==r.status&&"COMPLETADO"!==r.status?e("b-button",{directives:[{name:"user-can",rawName:"v-user-can",value:"actualizar citas",expression:"'actualizar citas'"},{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],attrs:{variant:"warning",size:"sm",title:"Reagendar Cita"},on:{click:function(e){return t.showModal("edit",r)}}},["Paciente"===t.role?e("i",{staticClass:"ri-history-line m-0"}):e("i",{staticClass:"ri-ball-pen-fill m-0"})]):t._e(),e("b-button",{directives:[{name:"user-can",rawName:"v-user-can",value:"eliminar citas",expression:"'eliminar citas'"},{name:"b-tooltip",rawName:"v-b-tooltip.hover",modifiers:{hover:!0}}],attrs:{variant:"danger",size:"sm",title:"Paciente"===t.role||"Doctor"===t.role?"Cancelar Cita":"Eliminar Cita"},on:{click:function(e){return t.destroy(r.id)}}},[e("i",{staticClass:"ri-delete-bin-line m-0"})])],1)],1)])]}}],null,!1,4085161396)}):t._e()]},proxy:!0}])})],1)],1),e("ModalForm",{attrs:{type:t.type,data:t.data,appointments:t.appointments},on:{getData:t.getData}}),e("ModalAddTreatment",{attrs:{data:t.appointmentData}}),e("b-modal",{attrs:{id:"modal-status",title:"Cambiar Estado","no-close-on-backdrop":"","hide-footer":""}},[e("ValidationObserver",{ref:"form",scopedSlots:t._u([{key:"default",fn:function(a){var r=a.handleSubmit;return[e("b-form",{on:{submit:function(e){return e.stopPropagation(),e.preventDefault(),r(t.submitStatus)}}},[e("b-row",[e("b-form-group",{staticClass:"col-md-12",attrs:{label:"Estado:","label-for":"status"}},[e("ValidationProvider",{attrs:{name:"Estado",rules:"required"},scopedSlots:t._u([{key:"default",fn:function(a){var r=a.errors;return[e("v-select",{class:r.length>0?" is-invalid":"",attrs:{options:t.filteredStatusOptions},model:{value:t.status,callback:function(e){t.status=e},expression:"status"}}),e("div",{staticClass:"invalid-feedback"},[e("span",[t._v(t._s(r[0]))])])]}}],null,!0)})],1),e("div",{staticClass:"col-md-12 w-100"},[e("b-button",{staticClass:"float-right",attrs:{type:"submit",variant:"primary"}},[t._v(" Actualizar ")])],1)],1)],1)]}}])})],1)],1)},i=[],n=a("c7eb"),o=a("1da1"),s=(a("b64b"),a("14d9"),a("442f")),c=a("bcae"),l=a("7424"),d=a("1fdb"),u=(a("a4d3"),a("e01a"),a("a15b"),function(){var t=this,e=t._self._c;return e("b-modal",{attrs:{id:"modal-form",size:"xl",title:"add"===t.type?"Agregar Cita":"Reagendar Cita","no-close-on-backdrop":"","hide-footer":""}},[e("ValidationObserver",{ref:"form",scopedSlots:t._u([{key:"default",fn:function(a){var r=a.handleSubmit;return[e("b-form",{on:{submit:function(e){return e.stopPropagation(),e.preventDefault(),r(t.onSubmit)}}},[1===t.step?e("p",[t._v("Seleccione servicio:")]):t._e(),1===t.step?e("b-row",t._l(t.services,(function(a,r){return e("b-col",{key:r,attrs:{sm:"6",md:"6",lg:"4",xl:"3"},on:{click:function(e){return t.nextStep(a.id)}}},[e("iq-card",{attrs:{"class-name":"iq-card-block iq-card-stretch iq-card-height","body-class":"iq-bg-primary rounded"},scopedSlots:t._u([{key:"body",fn:function(){return[e("div",{staticClass:"d-flex align-items-center justify-content-between"},[e("div",{staticClass:"rounded-circle iq-card-icon"},[e("img",{staticStyle:{width:"100%","object-fit":"cover","border-radius":"50%"},attrs:{src:a.icon}})]),e("div",{staticClass:"text-right"},[e("h5",[t._v(t._s(a.description))])])])]},proxy:!0}],null,!0)})],1)})),1):2===t.step?e("b-row",[e("b-form-group",{class:"Doctor"===t.role?"col-lg-12 col-md-12":"col-lg-6 col-md-12",attrs:{label:"Fecha:","label-for":"date"}},[e("ValidationProvider",{attrs:{name:"Fecha",rules:"required"},scopedSlots:t._u([{key:"default",fn:function(a){var r=a.errors;return[e("input",{directives:[{name:"model",rawName:"v-model",value:t.form.date,expression:"form.date"}],staticClass:"form-control",class:r.length>0?" is-invalid":"",attrs:{type:"date",min:(new Date).toISOString().substr(0,10),id:"date"},domProps:{value:t.form.date},on:{input:function(e){e.target.composing||t.$set(t.form,"date",e.target.value)}}}),e("div",{staticClass:"invalid-feedback"},[e("span",[t._v(t._s(r[0]))])])]}}],null,!0)})],1),"Doctor"!==t.role?e("b-form-group",{staticClass:"col-lg-6 col-md-12",attrs:{label:"Doctor:","label-for":"doctor_id"}},[e("ValidationProvider",{attrs:{name:"Doctor",rules:"required"},scopedSlots:t._u([{key:"default",fn:function(a){var r=a.errors;return[e("v-select",{class:r.length>0?" is-invalid":"",attrs:{options:t.filteredDoctors,label:"full_name",reduce:function(t){return t.id},disabled:"add"!=t.type},scopedSlots:t._u([{key:"option",fn:function(a){return[e("img",{staticClass:"mr-2",staticStyle:{"border-radius":"50%"},attrs:{height:"50px",src:a.photo}}),t._v(" "+t._s(a.full_name)+" ")]}}],null,!0),model:{value:t.form.doctor_id,callback:function(e){t.$set(t.form,"doctor_id",e)},expression:"form.doctor_id"}}),e("div",{staticClass:"invalid-feedback"},[e("span",[t._v(t._s(r[0]))])])]}}],null,!0)})],1):t._e(),e("b-col",{attrs:{md:"12"}},[e("p",[t._v("Horarios Disponibles:")])]),t.selectedTimeSlots.length>0?t._l(t.selectedTimeSlots,(function(a,r){return e("b-col",{key:r,attrs:{md:"6",lg:"4",sm:"6"},on:{click:function(e){return t.nextStep(a)}}},[e("b-alert",{staticClass:"text-white bg-primary",attrs:{show:!0}},[e("div",{staticClass:"iq-alert-text"},[t._v(" "+t._s(a.start_time)+" - "+t._s(a.final_time)+" ")])])],1)})):[t.form.date&&t.form.doctor_id?e("b-col",{staticClass:"text-center",attrs:{md:"12"}},[e("b",[t._v("NO HAY ATENCIÓN ESTE DÍA")])]):t._e()],e("div",{staticClass:"col-md-12 w-100"},["add"===t.type?e("b-button",{staticClass:"float-left",attrs:{variant:"primary"},on:{click:function(e){return t.prevStep()}}},[t._v(" Regresar ")]):t._e()],1)],2):e("b-row",["Paciente"!=t.role?e("b-form-group",{staticClass:"col-md-12",attrs:{label:"Paciente:","label-for":"patient_id"}},[e("ValidationProvider",{attrs:{name:"Paciente",rules:"required"},scopedSlots:t._u([{key:"default",fn:function(a){var r=a.errors;return[e("v-select",{class:r.length>0?" is-invalid":"",attrs:{options:t.patients,label:"full_name",reduce:function(t){return t.id}},model:{value:t.form.patient_id,callback:function(e){t.$set(t.form,"patient_id",e)},expression:"form.patient_id"}}),e("div",{staticClass:"invalid-feedback"},[e("span",[t._v(t._s(r[0]))])])]}}],null,!0)})],1):t._e(),e("b-form-group",{staticClass:"col-md-6",attrs:{label:"Notas:","label-for":"notes"}},[e("ValidationProvider",{attrs:{name:"Notas",rules:"required"},scopedSlots:t._u([{key:"default",fn:function(a){var r=a.errors;return[e("b-form-textarea",{class:r.length>0?" is-invalid":"",attrs:{id:"notes",placeholder:"Enter something...",rows:"2","max-rows":"4"},model:{value:t.form.notes,callback:function(e){t.$set(t.form,"notes",e)},expression:"form.notes"}}),e("div",{staticClass:"invalid-feedback"},[e("span",[t._v(t._s(r[0]))])])]}}],null,!0)})],1),e("div",{staticClass:"col-md-6 w-100"},[e("h4",[t._v("Resumen de Cita:")]),e("p",[e("b",[t._v("Fecha:")]),t._v(" "+t._s(t.data.date.split("-").reverse().join("/"))+" "),e("br"),e("b",[t._v("Hora:")]),t._v(" "+t._s(t.data.start_time)+"-"+t._s(t.data.final_time)+" "),e("br"),e("b",[t._v("Doctor:")]),t._v(" "+t._s(t.filterDoctor.full_name)+" "),e("br"),e("b",[t._v("Servicio:")]),t._v(" "+t._s(t.serviceSelected.description)+" ")])]),e("div",{staticClass:"col-md-12 w-100"},[e("b-button",{staticClass:"float-left",attrs:{variant:"primary"},on:{click:function(e){return t.prevStep()}}},[t._v(" Regresar ")]),e("b-button",{staticClass:"float-right",attrs:{type:"submit",variant:"primary"}},[t._v(" "+t._s("add"===t.type?"Agendar":"Actualizar")+" ")])],1)],1)],1)]}}])})],1)}),f=[],m=a("5530"),p=a("3835"),v=(a("4d90"),a("99af"),a("caad"),a("2532"),a("7db0"),a("a9e3"),a("159b"),a("fb6a"),a("2ca0"),a("3d20")),b=a.n(v),h=a("358c"),_={props:{type:{type:String,required:!0,default:"add"},data:{type:Object,required:!1},appointments:{type:Array}},data:function(){return{form:{patient_id:null,doctor_id:null,service_id:null,date:"",status:"AGENDADA",notes:""},doctors:[],patients:[],services:[],step:1,daySelected:null,role:null}},mounted:function(){var t=JSON.parse(localStorage.getItem("user"));this.role=t.role,this.getDoctors(),this.getPatients(),this.getServices()},watch:{data:function(t,e){if(null===t.service_id?this.step=1:this.step=2,this.form=t,"Doctor"===this.role){var a=JSON.parse(localStorage.getItem("user"));this.form.doctor_id=a.doctor_id}var r=new Date,i=r.getFullYear(),n=String(r.getMonth()+1).padStart(2,"0"),o=String(r.getDate()).padStart(2,"0");this.form.date="".concat(i,"-").concat(n,"-").concat(o),this.handleDate()}},computed:{filteredDoctors:function(){var t=this;return this.doctors.filter((function(e){return e.services.includes(t.form.service_id)}))},serviceSelected:function(){var t=this;return this.services.find((function(e){return e.id===t.form.service_id}))},filterDoctor:function(){var t=this;return this.doctors.find((function(e){return e.id===t.form.doctor_id}))},filterSchedule:function(){var t=this;return this.filterDoctor&&this.filterDoctor.schedules&&this.filterDoctor.schedules.length>0&&this.filterDoctor.schedules.find((function(e){return e.day===t.daySelected}))||{}},separateTimesBySlots:function(){var t,e;return this.fragmentTimeArray(this.filterSchedule.attention?this.filterSchedule.times:[],null!==(t=null===(e=this.filterDoctor)||void 0===e?void 0:e.slots_time)&&void 0!==t?t:30)},bookedTimes:function(){var t=this;return this.appointments.filter((function(e){return e.date===t.form.date})).filter((function(e){return e.doctor_id===t.form.doctor_id})).map((function(t){var e=t.start_time.split(":"),a=Object(p["a"])(e,2),r=a[0],i=a[1];return"".concat(r,":").concat(i,":00")}))},availableTimes:function(){var t=this;return this.separateTimesBySlots.filter((function(e){return!t.isTimeSlotBooked(e)}))},filteredTimeSlots:function(){var t=new Date,e="".concat(t.getHours(),":").concat(t.getMinutes(),":").concat(t.getSeconds());return this.availableTimes.filter((function(t){return t.start_time>=e}))},selectedTimeSlots:function(){var t=this.form.date,e=(new Date).toISOString().split("T")[0],a=t===e?this.filteredTimeSlots:this.availableTimes;return a}},methods:{handleDate:function(){var t=new Date(this.form.date),e=t.getDay(),a=["Lunes","Martes","Miércoles","Jueves","Viernes","Sábado","Domingo"],r=a[e];this.daySelected=r},handleService:function(){this.form.doctor_id=null},getDoctors:function(){var t=this;return Object(o["a"])(Object(n["a"])().mark((function e(){var a,r;return Object(n["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l["a"].get("/lists/doctors");case 3:a=e.sent,r=a.data,r=r.map((function(t){return Object(m["a"])(Object(m["a"])({},t),{},{photo:t.photo.includes("jpg")?t.photo:h["a"].defaultImage})})),console.log(r),t.doctors=r,e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](0),s["a"].fire({icon:"error",title:"Error"});case 13:case"end":return e.stop()}}),e,null,[[0,10]])})))()},getPatients:function(){var t=this;return Object(o["a"])(Object(n["a"])().mark((function e(){var a,r;return Object(n["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l["a"].get("/lists/patients");case 3:a=e.sent,r=a.data,t.patients=r,e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](0),s["a"].fire({icon:"error",title:"Error"});case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))()},getServices:function(){var t=this;return Object(o["a"])(Object(n["a"])().mark((function e(){var a,r;return Object(n["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l["a"].get("/lists/services");case 3:a=e.sent,r=a.data,t.services=r,e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](0),s["a"].fire({icon:"error",title:"Error"});case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))()},onSubmit:function(){"add"===this.type?this.saveData():this.updateData()},saveData:function(){var t=this;return Object(o["a"])(Object(n["a"])().mark((function e(){var a;return Object(n["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.a.fire({icon:"warning",title:"Seguro de guardar",showCancelButton:!0,confirmButtonText:"Si",cancelButtonText:"Cancelar"});case 3:if(a=e.sent,a.isConfirmed){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,l["a"].post("/appointments",t.form);case 8:t.form={patient_id:null,doctor_id:null,service_id:null,date:"",status:"AGENDADA",notes:""},t.$bvModal.hide("modal-form"),t.$emit("getData"),e.next=16;break;case 13:e.prev=13,e.t0=e["catch"](0),s["a"].fire({icon:"error",title:"Error"});case 16:case"end":return e.stop()}}),e,null,[[0,13]])})))()},updateData:function(){var t=this;return Object(o["a"])(Object(n["a"])().mark((function e(){return Object(n["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:l["a"].put("/appointments/".concat(t.data.id),t.form).then((function(){s["a"].fire({icon:"success",title:"Actualizado Correctamente"}),t.$bvModal.hide("modal-form"),t.$emit("getData")})).catch((function(){s["a"].fire({icon:"error",title:"Error"})}));case 1:case"end":return e.stop()}}),e)})))()},nextStep:function(t){switch(this.step){case 1:this.form.service_id=t;break;case 2:this.form.start_time=t.start_time,this.form.final_time=t.final_time;break;default:this.onSubmit();break}this.step++},prevStep:function(){this.step-=1},timeToMinutes:function(t){var e=t.split(":").map(Number),a=Object(p["a"])(e,3),r=a[0],i=a[1],n=a[2];return 60*r+i+n/60},fragmentTimeArray:function(t,e){var a=this,r=[];return t&&t.forEach((function(t){for(var i=t.start_time,n=t.final_time,o=a.timeToMinutes(i),s=a.timeToMinutes(n),c=o;c<s;c+=e){var l=Math.min(c+e,s);r.push({start_time:new Date(0,0,0,Math.floor(c/60),c%60).toTimeString().slice(0,8),final_time:new Date(0,0,0,Math.floor(l/60),l%60).toTimeString().slice(0,8)})}})),r},isTimeSlotBooked:function(t){return this.bookedTimes.some((function(e){return t.start_time.startsWith(e)}))}}},g=_,S=a("2877"),w=Object(S["a"])(g,u,f,!1,null,null,null),D=w.exports,y=a("f016"),k={components:{ModalForm:D,ModalAddTreatment:y["a"],DataTable:d["a"]},data:function(){return{status:"AGENDADA",data:{},type:"add",appointments:[],appointmentData:{},columns:[{name:"Código",field:"code",sort:""},{name:"Fecha",field:"date_format",sort:""},{name:"Servicio",field:"service",sort:""},{name:"Paciente",field:"patient",sort:""},{name:"Doctor",field:"doctor",sort:""},{name:"Estado",field:"status",sort:""}],filter:"actual",appointmentSelected:null,statusOptions:["AGENDADA","REAGENDADA","CANCELADO","COMPLETADO"],patientId:null,role:null}},mounted:function(){c["a"].index(),this.getData();var t=JSON.parse(localStorage.getItem("user"));this.role=t.role,"Paciente"===this.role&&(this.patientId=t.patient_id)},computed:{filteredStatusOptions:function(){var t=JSON.parse(localStorage.getItem("user"));return"Doctor"===t.role?this.statusOptions.filter((function(t){return"CANCELADO"===t||"COMPLETADO"===t})):"Paciente"===t.role?this.statusOptions.filter((function(t){return"REAGENDADA"===t})):this.statusOptions}},methods:{getData:function(){var t=this;return Object(o["a"])(Object(n["a"])().mark((function e(){var a,r;return Object(n["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l["a"].get("/appointments",{params:{filter:t.filter}});case 3:a=e.sent,r=a.data,t.appointments=r.data,e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](0),s["a"].fire({icon:"error",title:"Error"});case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))()},createTreatment:function(t){this.appointmentData=t,this.$bvModal.show("modal-add-treatment")},showModal:function(t,e){this.data={id:e.id,patient_id:e.patient_id,doctor_id:e.doctor_id,service_id:e.service_id,date:e.date,status:e.status,notes:e.notes},this.type=t,this.$bvModal.show("modal-form")},changeStatusModal:function(t,e){this.appointmentSelected=e.id,this.status=e.status,this.$bvModal.show(t)},submitStatus:function(){var t=this;return Object(o["a"])(Object(n["a"])().mark((function e(){return Object(n["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l["a"].patch("/appointments/".concat(t.appointmentSelected,"/update-status"),{status:t.status});case 3:t.$bvModal.hide("modal-status"),t.getData(),e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](0),s["a"].fire({icon:"error",title:"Error"});case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))()},destroy:function(t){var e=this;b.a.fire({icon:"warning",title:"Seguro de eliminar",showDenyButton:!1,showCancelButton:!0,confirmButtonText:"Si",cancelButtonText:"Cancelar"}).then((function(a){a.isConfirmed&&l["a"].delete("/appointments/".concat(t)).then((function(t){200===t.status&&(s["a"].fire({icon:"success",title:"Eliminado correctamente"}),e.getData())})).catch((function(t){s["a"].fire({icon:"error",title:t.message})}))}))},goToEdit:function(t){localStorage.setItem("userEdit",t),this.$router.push({name:"patient.detail"})}}},x=k,C=Object(S["a"])(x,r,i,!1,null,null,null);e["default"]=C.exports},f016:function(t,e,a){"use strict";a("a4d3"),a("e01a");var r=function(){var t=this,e=t._self._c;return e("b-modal",{attrs:{id:"modal-add-treatment",size:"xl",title:"Agregar Tratamiento","no-close-on-backdrop":"","hide-footer":""}},[e("ValidationObserver",{ref:"form",scopedSlots:t._u([{key:"default",fn:function(a){var r=a.handleSubmit;return[e("b-form",{on:{submit:function(e){return e.stopPropagation(),e.preventDefault(),r(t.onSubmit)}}},[e("b-row",[e("b-form-group",{staticClass:"col-md-4",attrs:{label:"Fecha:","label-for":"date"}},[e("ValidationProvider",{attrs:{name:"Fecha",rules:"required"},scopedSlots:t._u([{key:"default",fn:function(a){var r=a.errors;return[e("b-form-input",{class:r.length>0?" is-invalid":"",attrs:{id:"date",type:"date"},model:{value:t.form.date,callback:function(e){t.$set(t.form,"date",e)},expression:"form.date"}}),e("div",{staticClass:"invalid-feedback"},[e("span",[t._v(t._s(r[0]))])])]}}],null,!0)})],1),"Doctor"!=t.role?e("b-form-group",{staticClass:"col-md-4",attrs:{label:"Doctor:","label-for":"doctor_id"}},[e("ValidationProvider",{attrs:{name:"Doctor",rules:"required"},scopedSlots:t._u([{key:"default",fn:function(a){var r=a.errors;return[e("v-select",{class:r.length>0?" is-invalid":"",attrs:{options:t.doctors,label:"full_name",reduce:function(t){return t.id}},model:{value:t.form.doctor_id,callback:function(e){t.$set(t.form,"doctor_id",e)},expression:"form.doctor_id"}}),e("div",{staticClass:"invalid-feedback"},[e("span",[t._v(t._s(r[0]))])])]}}],null,!0)})],1):t._e(),e("b-form-group",{staticClass:"col-md-4",attrs:{label:"Paciente:","label-for":"patient_id"}},[e("ValidationProvider",{attrs:{name:"Paciente",rules:"required"},scopedSlots:t._u([{key:"default",fn:function(a){var r=a.errors;return[e("v-select",{class:r.length>0?" is-invalid":"",attrs:{options:t.patients,label:"full_name",reduce:function(t){return t.id}},model:{value:t.form.patient_id,callback:function(e){t.$set(t.form,"patient_id",e)},expression:"form.patient_id"}}),e("div",{staticClass:"invalid-feedback"},[e("span",[t._v(t._s(r[0]))])])]}}],null,!0)})],1),e("b-form-group",{staticClass:"col-md-4",attrs:{label:"Diagnostico:","label-for":"diagnostic_title"}},[e("ValidationProvider",{attrs:{name:"Diagnostico",rules:"required"},scopedSlots:t._u([{key:"default",fn:function(a){var r=a.errors;return[e("b-form-input",{class:r.length>0?" is-invalid":"",attrs:{type:"text",placeholder:"Diagnostico"},model:{value:t.form.diagnostic_title,callback:function(e){t.$set(t.form,"diagnostic_title",e)},expression:"form.diagnostic_title"}}),e("div",{staticClass:"invalid-feedback"},[e("span",[t._v(t._s(r[0]))])])]}}],null,!0)})],1),e("b-form-group",{staticClass:"col-md-4",attrs:{label:"Descripción:","label-for":"description"}},[e("ValidationProvider",{attrs:{name:"Descripción",rules:"required"},scopedSlots:t._u([{key:"default",fn:function(a){var r=a.errors;return[e("b-form-input",{class:r.length>0?" is-invalid":"",attrs:{type:"text",placeholder:"Descripción"},model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}}),e("div",{staticClass:"invalid-feedback"},[e("span",[t._v(t._s(r[0]))])])]}}],null,!0)})],1),e("b-form-group",{staticClass:"col-md-4",attrs:{label:"Objetivo:","label-for":"objective"}},[e("ValidationProvider",{attrs:{name:"Objetivo",rules:"required"},scopedSlots:t._u([{key:"default",fn:function(a){var r=a.errors;return[e("b-form-input",{class:r.length>0?" is-invalid":"",attrs:{type:"text",placeholder:"Objetivo"},model:{value:t.form.objective,callback:function(e){t.$set(t.form,"objective",e)},expression:"form.objective"}}),e("div",{staticClass:"invalid-feedback"},[e("span",[t._v(t._s(r[0]))])])]}}],null,!0)})],1),e("b-form-group",{staticClass:"col-md-12",attrs:{label:"Medicación:","label-for":"medication"}},[e("ValidationProvider",{attrs:{name:"Medicación",rules:"required"},scopedSlots:t._u([{key:"default",fn:function(a){var r=a.errors;return[e("b-form-textarea",{class:r.length>0?" is-invalid":"",attrs:{id:"medication",placeholder:"Ingrese la medicación...",rows:"2","max-rows":"4"},model:{value:t.form.medication,callback:function(e){t.$set(t.form,"medication",e)},expression:"form.medication"}}),e("div",{staticClass:"invalid-feedback"},[e("span",[t._v(t._s(r[0]))])])]}}],null,!0)})],1),e("div",{staticClass:"col-md-12 w-100"},[e("b-button",{staticClass:"float-right",attrs:{type:"submit",variant:"primary"}},[t._v(" Guardar ")])],1)],1)],1)]}}])})],1)},i=[],n=a("c7eb"),o=a("1da1"),s=(a("fb6a"),a("b64b"),a("442f")),c=a("7424"),l={components:{},props:{data:{type:Object,required:!1}},mounted:function(){this.getDoctors(),this.getPatients();var t=new Date;this.form.date=t.toISOString().slice(0,10);var e=JSON.parse(localStorage.getItem("user"));this.role=e.role},watch:{data:function(t,e){if("Doctor"===this.role){var a=JSON.parse(localStorage.getItem("user"));this.form.doctor_id=a.doctor_id}else this.form.doctor_id=t.doctor_id;this.form.patient_id=t.patient_id,this.form.appointment_id=t.id}},computed:{},methods:{onSubmit:function(){this.saveTreatment()},saveTreatment:function(){var t=this;return Object(o["a"])(Object(n["a"])().mark((function e(){return Object(n["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c["a"].post("/treatments",t.form);case 3:t.$bvModal.hide("modal-add-treatment"),t.$emit("getData"),s["a"].fire({icon:"success",title:"Tratamiento Creado"}),e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](0),s["a"].fire({icon:"error",title:"Error"});case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))()},getDoctors:function(){var t=this;return Object(o["a"])(Object(n["a"])().mark((function e(){var a,r;return Object(n["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c["a"].get("/lists/doctors");case 3:a=e.sent,r=a.data,t.doctors=r,e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](0),s["a"].fire({icon:"error",title:"Error"});case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))()},getPatients:function(){var t=this;return Object(o["a"])(Object(n["a"])().mark((function e(){var a,r;return Object(n["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c["a"].get("/lists/patients");case 3:a=e.sent,r=a.data,t.patients=r,e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](0),s["a"].fire({icon:"error",title:"Error"});case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))()}},data:function(){return{form:{doctor_id:null,patient_id:null,appointment_id:null,date:null,diagnostic_title:null,description:null,objective:null,medication:null},doctors:[],patients:[],role:null}}},d=l,u=a("2877"),f=Object(u["a"])(d,r,i,!1,null,null,null);e["a"]=f.exports}}]);
//# sourceMappingURL=chunk-3ff8147a.e6081bf9.js.map